[tox]
envlist =
    pylint, docs, runslow, doctest, production, clean
isolated_build = true

[testenv]
description = Running {envname} with {basepython}
passenv = HOME

basepython = python3.7

setenv =
    PIP_DISABLE_VERSION_CHECK = 1
    PYTHONPATH = {toxinidir}

whitelist_externals = poetry
skip_install = true
commands =
    poetry build

    clean: {toxinidir}/tox/clean.sh

    docs: pip install `ls dist/*.whl`[docs,library]
    runslow,doctest: pip install `ls dist/*.whl`[pytest,library]
    pylint: pip install `ls dist/*.whl`[pytest,pylint,library]

    doctest: poetry run pytest -v --basetemp={envtmpdir} --junitxml=junit/.test.{envname}.xml [] --doctest-modules
    runslow: poetry run pytest -v --run-slow --basetemp={envtmpdir} --junitxml=junit/.test.{envname}.xml []
    docs: poetry run sphinx-build -W docs docs/_build/html
    pylint: poetry run pytest --pylint --pylint-jobs=1

    production: poetry install -vvv --no-dev
    production: pip install pymedphys[pytest,pylint,library]==`poetry run python -c "import pymedphys; print(pymedphys.__version__)"`
    production: pytest -v --run-slow --pylint --pylint-jobs=1 --doctest-modules --basetemp={envtmpdir} --junitxml=junit/.test.{envname}.xml []
