[tox]
envlist =
    pylint, docs, runslow, doctest, production
isolated_build = true

[testenv]
description = Running {envname} with {basepython}
passenv = HOME

basepython = python3.7

setenv =
    PIP_DISABLE_VERSION_CHECK = 1
    PYTHONPATH = {toxinidir}

whitelist_externals = poetry
skip_install = true
commands =
    pip install -r tox-requirements.txt
    docs: poetry install -vvv --no-dev -E docs -E library
    runslow,doctest: poetry install -vvv --no-dev -E pytest -E library
    pylint: poetry install -vvv --no-dev -E pylint -E pytest -E library

    doctest: poetry run pytest -v --basetemp={envtmpdir} --junitxml=junit/.test.{envname}.xml [] --doctest-modules
    runslow: poetry run pytest -v --run-slow --basetemp={envtmpdir} --junitxml=junit/.test.{envname}.xml []
    docs: poetry run sphinx-build -W docs docs/_build/html
    pylint: poetry run pytest --pylint --pylint-jobs=1

    production: poetry install -vvv --no-dev
    production: pip install pymedphys[pytest,pylint]==`poetry run python -c "import pymedphys; print(pymedphys.__version__)"`
    production: pytest -v --run-slow --pylint --pylint-jobs=1 --doctest-modules --basetemp={envtmpdir} --junitxml=junit/.test.{envname}.xml []
